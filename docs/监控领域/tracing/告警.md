## 安装dingding webhook

```
rm -rf /data/tristan/webhook_dingtalk
mkdir -p /data/tristan/webhook_dingtalk/template && chmod 777 /data/tristan/webhook_dingtalk/template

sudo tee /data/tristan/webhook_dingtalk/template/alert.tmpl <<-'EOF'
{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}
{{ define "__alertmanagerURL" }}{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver }}{{ end }}
{{ define "__text_alert_list" }}{{ range . }}
**报警详情**
{{ range .Annotations.SortedPairs }}> - {{ .Name }}: {{ .Value | markdown | html }}
{{ end }}

{{ end }}{{ end }}

{{ define "ding.link.title" }}{{ template "__subject" . }}{{ end }}
{{ define "ding.link.content" }}#### \[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}\] **[{{ index .GroupLabels "alertname" }}]({{ template "__alertmanagerURL" . }})**
{{ template "__text_alert_list" .Alerts.Firing }}
{{ end }}
EOF

docker stop webhook_dingtalk && docker rm webhook_dingtalk
docker run -d \
  --name=webhook_dingtalk \
  -p 8060:8060 --restart always \
  -v /data/tristan/prometheus_webhook_dingtalk/template:/opt/dingding_api/ \
  timonwong/prometheus-webhook-dingtalk:v1.4.0 --ding.profile="webhook1=https://oapi.dingtalk.com/robot/send?access_token=<access_token>" --template.file="/opt/dingding_api/alert.tmpl"

docker logs -f --tail 100 webhook_dingtalk
docker restart webhook_dingtalk
```

使用: http://192.168.2.20:8060/dingtalk/webhook1/send



# 配置webhooks

修改configs/alarm-settings.yml

```
webhooks:
  - http://192.168.2.20:8060/dingtalk/webhook1/send
```

